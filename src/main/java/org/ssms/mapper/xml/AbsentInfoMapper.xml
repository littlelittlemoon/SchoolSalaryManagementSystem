<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.ssms.mapper.AbsentInfoMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="org.ssms.entity.AbsentInfo">
        <id column="staff_id" property="staffId"/>
        <result column="absent_reason" property="absentReason"/>
        <result column="absent_apply_time" property="absentApplyTime"/>
        <result column="absent_start_time" property="absentStartTime"/>
        <result column="absent_end_time" property="absentEndTime"/>
        <result column="absent_days" property="absentDays"/>
        <result column="absent_check_time" property="absentCheckTime"/>
        <result column="absent_state" property="absentState"/>
    </resultMap>

    <resultMap id="CheckResultMap" type="org.ssms.mapper.result.AbsentInfoCheck">
        <result column="staff_id" property="staffId"/>
        <result column="staff_name" property="staffName"/>
        <result column="absent_apply_time" property="absentApplyTime"/>
        <result column="absent_reason" property="absentReason"/>
        <result column="absent_start_time" property="absentStartTime"/>
        <result column="absent_end_time" property="absentEndTime"/>
        <result column="absent_days" property="absentDays"/>
    </resultMap>

    <select id="getAbsentInfoCheck" resultMap="CheckResultMap">
      SELECT
          a.staff_id,
          staff_name,
          absent_apply_time,
          absent_reason,
          absent_start_time,
          absent_end_time,
          absent_days
        FROM
          t_absent_info a, t_staff_info b
        WHERE a.staff_id = b.staff_id
          AND department_id IN (SELECT department_id
                                FROM t_staff_info
                                WHERE staff_id = #{staffId})
         AND absent_state = 'std'
    </select>
</mapper>
